/*!CK:2263005994!*//*1399874826,178150437*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ZPJC4"]); }

__d("PlaceTagType",[],function(a,b,c,d,e,f){e.exports={CITY:"city",STATE_PROVINCE:"state_province",COUNTRY:"country",PLACE:"place",EVENT:"event",UNCONFIRMED_RESIDENCE:"unconfirmed_residence",RESIDENCE:"residence",TEXT:"text"};});
__d("PhotoAlbumAudienceInput",["Arbiter","CSS","DOM","Event"],function(a,b,c,d,e,f,g,h,i,j){function k(l,m,n,o,p){"use strict";this.$PhotoAlbumAudienceInput0=l;if(m){this.$PhotoAlbumAudienceInput1=m;this.$PhotoAlbumAudienceInput2=n;this.$PhotoAlbumAudienceInput3=o;this.$PhotoAlbumAudienceInput4=p;g.subscribe('Tokenizer/init',this.$PhotoAlbumAudienceInput5.bind(this));j.listen(this.$PhotoAlbumAudienceInput3,'click',this.$PhotoAlbumAudienceInput6.bind(this));}}k.prototype.removeHiddenPrivacyWidget=function(){"use strict";[this.$PhotoAlbumAudienceInput0,this.$PhotoAlbumAudienceInput1,this.$PhotoAlbumAudienceInput4].forEach(function(l){if(l&&h.hasClass(l,'hidden_elem'))i.remove(l);});};k.prototype.$PhotoAlbumAudienceInput6=function(){"use strict";this.$PhotoAlbumAudienceInput7.removeAllTokens();this.$PhotoAlbumAudienceInput8(null,null);};k.prototype.$PhotoAlbumAudienceInput5=function(l,m){"use strict";if(this.$PhotoAlbumAudienceInput7||this.$PhotoAlbumAudienceInput2!=m.element)return;this.$PhotoAlbumAudienceInput7=m;this.$PhotoAlbumAudienceInput8(null,null);g.subscribe('Form/change',this.$PhotoAlbumAudienceInput8.bind(this));};k.prototype.$PhotoAlbumAudienceInput8=function(l,m){"use strict";var n=this.$PhotoAlbumAudienceInput7.getTokens().length>0;this.$PhotoAlbumAudienceInputa(n);};k.prototype.$PhotoAlbumAudienceInputa=function(l){"use strict";h.conditionShow(this.$PhotoAlbumAudienceInput1,l);h.conditionShow(this.$PhotoAlbumAudienceInput0,!l);this.$PhotoAlbumAudienceInput4&&h.conditionShow(this.$PhotoAlbumAudienceInput4,l);};e.exports=k;});
__d("PhotoAlbumPlacesTypeahead",["Arbiter"],function(a,b,c,d,e,f,g){function h(i){"use strict";if(!i)return;if(i.getCore().getHiddenValue()){var j={uid:i.getCore().getHiddenValue(),text:i.getCore().getValue()};g.inform('PhotoAlbumPlacesTypeahead.EXIST_PLACE',j);}i.subscribe('select',function(k,l){g.inform('PhotoAlbumPlacesTypeahead.SELECTED_PLACE',l.selected);}.bind(this));i.subscribe('reset',function(){if(!i.getCore().getHiddenValue())g.inform('PhotoAlbumPlacesTypeahead.RESET_PLACE');}.bind(this));this._initialized=true;}h.prototype.init=function(i){"use strict";if(this._initialized)return;h.call(this,i);};e.exports=h;});
__d("PhotoBulkEditTagger",["Arbiter","AsyncRequest","CSS","DOM","DOMQuery","Event","FaceboxSourceConstants","Parent","PhotosConst","PhotosTaggingWaterfall","PhotoTagger","SubscriptionsHandler","Vector","$","copyProperties","csx","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x=60;for(var y in q)if(q.hasOwnProperty(y))aa[y]=q[y];var z=q===null?null:q.prototype;aa.prototype=Object.create(z);aa.prototype.constructor=aa;aa.__superConstructor__=q;function aa(ba,ca,da,ea){"use strict";q.call(this,ba);this.editor=ba;this.faceboxes=[];this.gkEnableTagNext=ea.gkEnableTagNext;this._qn=ea.qn;this.tokenizer=da;this.editor.registerTagger(this);this.typeahead=da.getTypeahead();this.handlers=new r();this.root=this.editor.getRoot();this.tagger=ca;this.hideNewTagTimer=null;this.photoKey=null;this._needTaggingData=true;this._currentRecognition={box:null,isTagged:false,suggestion:null};this._hoverState=false;this._tagging=false;this.setupHandlers();this._sendWaterfallLogSignal(p.BEGIN);this.fetchTaggingSuggestions();this.setTagAccumulator(ea.bulkSaveTags);this.setNeedTaggingData(ea.needTaggingData);this.version=o.BULK_EDITOR;l.listen(this.root,'mousemove',function(event){var fa=event.getTarget();if(this._hoverState&&!(n.byClass(fa,'faceBox')||n.byClass(fa,'tagPointer')||n.byClass(fa,'arrow')||n.byClass(fa,'faceboxSuggestion'))){this.removeSuggestionFromTagger();this.hideTagger();}}.bind(this));}aa.prototype.setupUserActionLogging=function(){"use strict";return null;};aa.prototype.logUserActionEvent=function(ba){"use strict";return null;};aa.prototype.addFaceboxes=function(ba){"use strict";this.faceboxes=k.scry(ba.parentNode,'.faceBox');this.faceboxes.sort(function(ca,da){return ca.offsetLeft===da.offsetLeft?ca.offsetTop-da.offsetTop:ca.offsetLeft-da.offsetLeft;});this.faceboxes.forEach(function(ca){var da={image:ba,facebox:ca};l.listen(ca,'mouseenter',this._mouseOverFacebox.bind(this,da));}.bind(this));};aa.prototype.saveTag=function(ba,ca,da){"use strict";z.saveTag.call(this,ba,ca,da);g.inform('PhotoBulkEditTagger.TAG_SAVED',{editor:this.root,fbid:this.photoData.fbid});};aa.prototype.setNeedTaggingData=function(ba){"use strict";this._needTaggingData=ba;return this;};aa.prototype.setTagAccumulator=function(ba){"use strict";z.setTagAccumulator.call(this,ba);return this;};aa.prototype.needTaggingData=function(){"use strict";return this._needTaggingData;};aa.prototype.setupHandlers=function(){"use strict";l.listen(this.root,'click',this.clickHandler.bind(this));this.tokenizer.subscribe(['addToken','removeToken'],this.handleTokenAction.bind(this));this.tokenizer.subscribe('switchTarget',this.switchPhoto.bind(this));g.subscribe('PhotoBulkEditTagger.DATA_SOURCE_READY',this.useTaggingDataSource.bind(this));g.subscribe(this.editor.mapEventNameToNamespace('PhotosBulkEditor.PHOTO_REORDER_START'),this.hideTagger.bind(this));};aa.prototype.hideTagger=function(){"use strict";z.hideTagger.apply(this,arguments);if(this._currentRecognition.box&&!this._currentRecognition.isTagged)i.show(this._currentRecognition.box);this._tagging=false;this._hoverState=false;this._currentRecognition.box=null;this._currentRecognition.isTagged=false;this._currentRecognition.suggestion=null;this.recognizedUsers=[];};aa.prototype.done=function(){"use strict";this._sendWaterfallLogSignal(p.FINISH);};aa.prototype.handleTokenAction=function(ba,ca){"use strict";var da=t(this.photoKey),ea=j.find(da,'.peopleIcon'),fa=j.find(da,'.editablePhotoTagList'),ga=j.find(ea,'.count'),ha=this.tokenizer.getTokens().length,ia=ca.info.suggestion?m.UPLOADER_SUGGEST:null;if(this._currentRecognition.box)this._currentRecognition.isTagged=!!ha;i.conditionClass(ea,'hasPeople',!!ha);i.conditionClass(fa,'hasPeople',!!ha);j.setContent(ga,ha);if(ba=='addToken'){this.saveTag(ba,ca,ia);if(!this.gkEnableTagNext)return;for(var ja=0;ja<this.faceboxes.length;ja++)if(i.shown(this.faceboxes[ja])){setTimeout(function(){this.showTaggerByFacebox(this.faceboxes[ja]);}.bind(this),100);break;}}else this.removeTag(ba,ca);};aa.prototype.useTaggingDataSource=function(ba,ca){"use strict";if(!this._needTaggingData)return;var da=this.tokenizer.getTypeahead();da.swapData(ca);this.setNeedTaggingData(false);};aa.prototype.getTaggerPositioningOrigin=function(){"use strict";return s.getElementPosition(this.root);};aa.prototype.showTaggerByFacebox=function(ba){"use strict";var ca=n.byClass(ba,'faceBox');if(!ca)ca=n.byClass(ba,'recognitionBox');this._currentRecognition.box=ca;var da=n.byClass(ba,'editablePhotoImage');this.setupPhotoDataForTarget(da);var ea=j.find(da,'.scaledImage img'),fa=null,ga=null,ha=null,ia=this.getRecognitionBoxCenter(ca,ea);fa=ia.boxPos;ga=ia.boxDim;ha=ia.taggerPos;i.hide(this._currentRecognition.box);this.recognizedUsers=JSON.parse(ca.getAttribute('data-recognizeduids'));this.setUpTagger(ea,da,fa,ga,ha);};aa.prototype.getRecognitionBoxCenter=function(ba,ca){"use strict";var da=s.getElementPosition(ba).add(s.getElementDimensions(ba).mul(.5)),ea=s.getElementDimensions(this._currentRecognition.box),fa=this.calcTaggerPosition(ca,da,ea.x,ea.y);return {boxPos:da,boxDim:ea,taggerPos:fa};};aa.prototype.setUpTagger=function(ba,ca,da,ea,fa){"use strict";this.calcClickPoint(ba,da);fa.setElementPosition(this.tagger);if(ea)ea.setElementDimensions(this.tagger);i.hide(j.find(ca,'.clickToTagMessage'));this._sendWaterfallLogSignal(p.TAG_FACE);this.updateTypeaheadSuggestions();this.updateWithSuggestions();this.showTagger();this._tagging=true;};aa.prototype.clickHandler=function(event){"use strict";var ba=event.getTarget();if(n.byClass(ba,'photoTagTypeahead'))return;if(this._hoverState){this._hoverState=false;this._tagging=true;return;}if(this.tagger){this.hideTagger();this.removeSuggestionFromTagger();this.handlers.release();}if(n.byClass(ba,'photoContextualSelector')||n.byClass(ba,'removePhotoButton'))return;var ca=n.byClass(ba,'editablePhotoImage');if(!ca){var da=n.byClass(ba,'peopleIcon');if(da)this.setupPhotoDataForTarget(da);return;}this.setupPhotoDataForTarget(ca);var ea=j.find(ca,'.scaledImage img'),fa=null,ga=null,ha=null,ia=n.byClass(ba,'faceBox');if(!ia)ia=n.byClass(ba,'recognitionBox');this._currentRecognition.box=ia;if(this._currentRecognition.box&&i.shown(this._currentRecognition.box)){var ja=this.getRecognitionBoxCenter(ia,ea);fa=ja.boxPos;ga=ja.boxDim;ha=ja.taggerPos;i.hide(this._currentRecognition.box);this._currentRecognition.isTagged=false;var ka=this.getFaceboxSuggestionFromFaceboxElem(ia);if(ka){this._currentRecognition.suggestion=ka;this.addSuggestionToTagger(ia,ka);this._sendFaceboxSuggestionLogSignal(ka.getAttribute('data-id'),m.UPLOADER_SUGGEST);}else this.recognizedUsers=JSON.parse(ia.getAttribute('data-recognizeduids'));}if(ha===null){fa=s.getEventPosition(event);ha=this.calcTaggerPosition(ea,fa,x);}if(!ha)return;this.setUpTagger(ea,ca,fa,ga,ha);};aa.prototype._mouseOverFacebox=function(ba){"use strict";if(this._tagging)return;var ca=ba.image,da=ba.facebox,ea=this.getFaceboxSuggestionFromFaceboxElem(da);if(ea){this._hoverState=true;this._currentRecognition.box=da;this._currentRecognition.suggestion=ea;this.setupPhotoDataForTarget(ca);this.addSuggestionToTagger(da,ea);this._sendFaceboxSuggestionLogSignal(ea.getAttribute('data-id'),m.UPLOADER_SUGGEST);this._sendWaterfallLogSignal(p.HOVER_TAG_FACE);var fa=s.getElementPosition(da).add(s.getElementDimensions(da).mul(.5)),ga=s.getElementDimensions(this._currentRecognition.box),ha=this.calcTaggerPosition(ca,fa,ga.x,ga.y);this.calcClickPoint(ca,fa);ha.setElementPosition(this.tagger);ga.setElementDimensions(this.tagger);this.showTagger();}};aa.prototype.fetchTaggingSuggestions=function(){"use strict";this.logUserActionEvent('sugg_fetch');new h().setURI(this.ajaxURIs.tagsInit).setData({owner:this.photoData.owner}).setOption('retries',1).setHandler(function(ba){var ca=ba.getPayload();this.featuredSuggestions=ca.featuredTaggees;this.friendSuggestions=ca.friendTaggees;this.logUserActionEvent('sugg_fetch_done');}.bind(this)).send();};aa.prototype.switchPhoto=function(ba,ca){"use strict";var da=w(ca);da&&this.setupPhotoDataForTarget(da);this.hideTagger();};aa.prototype.getImageByID=function(ba){"use strict";return w('editablePhoto_'+ba);};aa.prototype.setupPhotoDataForTarget=function(ba){"use strict";var ca;if(ba&&!i.hasClass(ba,'editablePhoto')){ca=n.byClass(ba,'editablePhoto');}else ca=ba;if(!ca){this.photoKey=null;this.photoData=null;return false;}var da=ca.id;if(da===this.photoKey)return;this.photoKey=da;this.photoData=this.editor.getPhotoData(da);this.tokenizer.setTokenarea(j.find(ca,'div.editablePhotoTagList'));};aa.prototype.getPosition=function(){"use strict";return this.photoData.fbid;};aa.prototype.tagsChangeHandler=function(ba){"use strict";};aa.prototype.removeTagByID=function(ba,ca,da){"use strict";this.hideTagger();this.setupPhotoDataForTarget(this.getImageByID(ba));z.removeTagByID.call(this,ba,ca,da);};aa.prototype.setupFaceboxSuggestionHandlers=function(ba,ca){"use strict";var da=j.find(ca,"._570w"),ea=j.find(ca,"._570x");this.handlers.engage();this.handlers.addSubscriptions(l.listen(da,'click',function(fa){this.dismissFaceboxSuggestion(ba.id.replace('face:',''),ca.getAttribute('data-id'),this.photoData.owner,m.UPLOADER_DISMISS);this.removeSuggestionFromTagger();this.hideTagger();j.remove(this.getFaceboxSuggestionFromFaceboxElem(ba));}.bind(this)),l.listen(ea,'click',function(fa){var ga=this.tokenizer.createToken({uid:ca.getAttribute('data-id'),text:ca.getAttribute('data-text'),suggestion:true});this.removeSuggestionFromTagger();i.hide(ba);this.tokenizer.addToken(ga);}.bind(this)));};u(aa.prototype,{elemNames:{}});e.exports=aa;});
__d("PhotosBulkBackdateEditor",["Event","Arbiter","DOMQuery","Focus","Form"],function(a,b,c,d,e,f,g,h,i,j,k){var l={setup:function(m,n){g.listen(m,'click',function(){n.setContext(m);n.show();});var o=i.find(n.getContent(),"^.photosBulkDatePicker .saveBackdatedTime");g.listen(o,'click',function(){var p=k.serialize(n.getContent()),q=p.backdated_date,r=parseInt(p.use_date_from_file,10)>0,s=i.scry(n.getContent(),'#hide_from_newsfeed')[0],t=s&&s.checked;h.inform('PhotosBulkBackdateEditor.SAVED',{context:m,backdatedDate:q,hideFromNewsfeed:t,useDateFromFile:r});n.hide();j.set(m);});}};e.exports=l;});
__d("PhotoBulkEditTokenizer",["DOM","Event","Input","Parent","Tokenizer","UserAgent","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){for(var n in k)if(k.hasOwnProperty(n))p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(){"use strict";if(k!==null)k.apply(this,arguments);}p.prototype.init=function(q,r,s,t){"use strict";this._tokenareaListeners={};o.init.call(this,q,r,s,t);this.inform('initialized');};p.prototype.initEvents=function(){"use strict";var q=l.firefox()<4?'keypress':'keydown';h.listen(this.input,'paste',this.paste.bind(this));h.listen(this.input,q,this.keydown.bind(this));};p.prototype.setTokenarea=function(q){"use strict";this.tokenarea=q;this.addTokenareaListener(q);this.reset();};p.prototype.addTokenareaListener=function(q){"use strict";if(this._tokenareaListeners[q.id])return;var r=this.handleEvents.bind(this);this._tokenareaListeners[q.id]=m(h.listen(q,{click:r,keydown:r}));};p.prototype.handleEvents=function(event){"use strict";var q=j.byClass(event.getTarget(),'editablePhotoTagList');if(!q){return;}else if(this.tokenarea!==q){this.setTokenarea(q);this.inform('switchTarget',this.tokenarea.id);}return o.handleEvents.call(this,event);};p.prototype.reset=function(){"use strict";var q=this.getTokenElements().map(function(r){return {uid:g.scry(r,'input')[0].value,text:g.scry(r,'input')[1].value};});i.reset(this.input);return o.reset.call(this,q);};p.prototype.updateTokenareaVisibility=function(){"use strict";return null;};p.prototype.insertToken=function(q){"use strict";g.prependContent(this.tokenarea,q.getElement());};e.exports=p;});
__d("PlaceUtils",["PlaceTagType"],function(a,b,c,d,e,f,g){var h={placesClose:function(i,j,k,l){i=i||0;j=j||0;k=k||0;l=l||0;return (Math.abs(i-k)<1e-05)&&(Math.abs(j-l)<1e-05);},isNonSpecificPlace:function(i){return (i==g.CITY||i==g.STATE_PROVINCE||i==g.COUNTRY);}};e.exports=h;});
__d("ProgressiveDatepicker",["Arbiter","ArbiterMixin","CSS","DataStore","DOM","Event","Parent","copyProperties","mixin","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(w){return new Date(w[0],w[1],w[2],w[3],w[4]);}function r(w,x){while(w.length)k.insertAfter(x,w.pop());}var s=o(h);for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w,x){"use strict";this._root=w;this._savedLabels={};this._savedPeriodsBack=[];this._savedPeriodsFront=[];this._menus={};this._mintime=x.mintime&&new Date(1000*x.mintime);this._maxtime=x.maxtime&&new Date(1000*x.maxtime);j.set(w,'datepicker',this);k.scry(w,'select').forEach(function(y){l.listen(y,'change',p(this._handleChange,this,y));var z=m.byClass(y,'period');l.listen(y,'focus',i.addClass.bind(null,z,'periodFocus'));l.listen(y,'blur',i.removeClass.bind(null,z,'periodFocus'));this._setMenuSelectionState(y);if(y.getAttribute('data-name')==='month')this._filterInvalidDates();}.bind(this));k.scry(w,'a.periodLabel').forEach(function(y){var z=m.byClass(y,'period');l.listen(y,'click',function(){i.addClass(z,'periodSelected');i.addClass(z,'periodFocus');});});this._filterInvalidDates();this.inform('initialized',this,g.BEHAVIOR_STATE);}v.prototype.setDate=function(w,x,y,z,aa){"use strict";this._addSavedPeriods();var ba=v.PERIODS;for(var ca=0;ca<ba.length;ca++)this._setValueForPeriod(ba[ca],arguments[ca]);this._filterInvalidDates();this.inform('changed');};v.prototype.setDateWithTimestamp=function(w){"use strict";var x=new Date(w);this.setDate(x.getFullYear(),x.getMonth()+1,x.getDate(),x.getHours(),x.getMinutes());};v.prototype.isSet=function(){"use strict";var w=v.PERIODS;for(var x=0;x<w.length;x++)if(this._getValueForPeriod(w[x]))return true;return false;};v.prototype.getRoot=function(){"use strict";return this._root;};v.prototype.getValues=function(){"use strict";var w=v.PERIODS,x={};for(var y=0;y<w.length;y++){var z=this._getValueForPeriod(w[y]);if(z)x[w[y]]=z;}return x;};v.prototype.getDate=function(){"use strict";var w=this.getValues();return new Date(w.year||0,(w.month||1)-1,w.day||1,w.hour||0,w.minute||0);};v.prototype.getTimestamp=function(){"use strict";return Math.round(this.getDate().getTime()/1000);};v.prototype._setValueForPeriod=function(w,x){"use strict";var y=this._menuForPeriodName(w);if(!y)return;if(x===undefined)x='';var z=y.options;for(var aa=0,ba=z.length;aa<ba;aa++)if(z[aa].value==x){y.selectedIndex=aa;break;}this._setMenuSelectionState(y);};v.prototype._getValueForPeriod=function(w){"use strict";var x=this._menuForPeriodName(w);return (x&&x.options[x.selectedIndex].value);};v.prototype._handleChange=function(w){"use strict";this._setMenuSelectionState(w);this._filterInvalidDates();this.inform('changed');};v.prototype._setMenuSelectionState=function(w){"use strict";var x=m.byClass(w,'period');if(!x)return;if(i.hasClass(x,'periodRequired')){if(w.selectedIndex===0)w.selectedIndex=1;}else this._updateLabel(w);var y=w.getAttribute('data-name'),z=w.options[w.selectedIndex].value;i.conditionClass(x,'periodSelected',z);i.conditionClass(this._root,this._selectedClass(y),z);if(!z)this._resetMenu(v.PERIODS.indexOf(y)+1);};v.prototype._updateLabel=function(w){"use strict";var x=w.getAttribute('data-name'),y=w.options[0];if(!this._savedLabels[x])this._savedLabels[x]=k.getText(y);if(w.selectedIndex===0){k.setContent(y,this._savedLabels[x]);}else k.setContent(y,'--');};v.prototype._daysInMonth=function(w,x){"use strict";return new Date(w||1999,x+1||1,0).getDate();};v.prototype._daysInCurrentMonth=function(){"use strict";return this._daysInMonth(this._getValueForPeriod('year'),this._getValueForPeriod('month')-1);};v.prototype._menuForPeriodName=function(w){"use strict";if(!this._menus[w])this._menus[w]=k.scry(this._root,'.'+w+'Menu')[0];return this._menus[w];};v.prototype._selectedClass=function(w){"use strict";return 'uiProgressiveDatepickerSelected-'+w;};v.prototype._resetMenu=function(w){"use strict";var x=v.PERIODS;for(;w<x.length;w++){var y=x[w],z=this._menuForPeriodName(y);if(!z)return;if(m.byClass(z,'periodRequired')){z.selectedIndex=1;}else{i.removeClass(m.byClass(z,'period'),'periodSelected');i.removeClass(this._root,this._selectedClass(y));z.selectedIndex=0;this._updateLabel(z);}}};v.prototype._addSavedPeriods=function(){"use strict";var w=v.PERIODS;for(var x=0;x<w.length;x++){var y=this._menuForPeriodName(w[x]);if(!y)return;this._savedPeriodsFront[x]||(this._savedPeriodsFront[x]=[]);this._savedPeriodsBack[x]||(this._savedPeriodsBack[x]=[]);var z=y.options[0],aa=y.options[y.options.length-1];if(x===v.PERIODS.indexOf('hour')||x===v.PERIODS.indexOf('minute')){r(this._savedPeriodsFront[x],z);r(this._savedPeriodsBack[x],aa);}else{r(this._savedPeriodsBack[x],z);r(this._savedPeriodsFront[x],aa);}}};v.prototype._filterInvalidDates=function(){"use strict";this._addSavedPeriods();var w=v.PERIODS,x=this.getValues();for(var y=0;y<w.length;y++){var z=this._menuForPeriodName(w[y]);if(!z)return;this._savedPeriodsFront[y]||(this._savedPeriodsFront[y]=[]);this._savedPeriodsBack[y]||(this._savedPeriodsBack[y]=[]);for(var aa=1;aa<z.options.length;){var ba=z.options[aa],ca=[((y-1>=0)?x[w[0]]:0),((y-1>=1)?x[w[1]]-1:0),((y-1>=2)?x[w[2]]:1),((y-1>=3)?x[w[3]]:0),((y-1>=4)?x[w[4]]:0)];ca[y]=ba.value;if(y===v.PERIODS.indexOf('month'))ca[y]=ca[y]-1;var da=q(ca),ea=[((y-1>=0)?x[w[0]]:9001),((y-1>=1)?x[w[1]]-1:11),((y-1>=2)?x[w[2]]:this._daysInCurrentMonth()),((y-1>=3)?x[w[3]]:23),((y-1>=4)?x[w[4]]:59)];ea[y]=ba.value;if(y===v.PERIODS.indexOf('month')){ea[y]--;ea[y+1]=this._daysInMonth(ea[0],ea[1]);}var fa=q(ea),ga=(da>this._maxtime),ha=(fa<this._mintime),ia=(y===v.PERIODS.indexOf('day')&&ba.value>this._daysInCurrentMonth());if(ha||ga||ia){if(ba.selected){ba.selected=false;this._resetMenu(y);}k.remove(ba);if(ga||ia){this._savedPeriodsBack[y].push(ba);}else this._savedPeriodsFront[y].push(ba);}else aa++;}}};v.getInstance=function(w){"use strict";return w?j.get(w,'datepicker'):null;};n(v,{PERIODS:['year','month','day','hour','minute']});e.exports=v;});
__d("PhotosBulkEditablePhoto",["Arbiter","AsyncDialog","AsyncRequest","AsyncResponse","CSS","Dialog","DOM","Event","Focus","Form","Input","Parent","PhotosConst","PlaceUtils","ProgressiveDatepicker","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=null,x=null,y=false;function z(aa,ba,ca,da,ea){"use strict";this._root=aa;this._mentionsTypeahead=ba;this._placesTypeahead=ca;this._photoData=da;this._hasOwnPlaceValue=!!ca.getCore().getHiddenValue();var fa=m.find(aa,'.placesInput'),ga=m.find(aa,'.captionTextarea');this._metadataInputs=m.find(aa,'.metadataInputs');this._editorId=ea;this._photoDataKey=this._root.id;this._hasTimeTaken=!!this._photoData.timeTaken;this._hasExistingDateValue=this._photoData.isBackdated||this._photoData.hasDerivedDateFromAlbum;this._listeners=[n.listen(aa,'click',this._handleClick.bind(this)),n.listen(fa,'focus',this._placesFocus.bind(this)),n.listen(fa,'mouseleave',this._placesMouseLeave.bind(this)),n.listen(ga,'focus',this._captionFocus.bind(this)),n.listen(ga,'mouseenter',this._captionMouseEnter.bind(this)),n.listen(ga,'mouseleave',this._captionMouseLeave.bind(this)),n.listen(ga,'blur',this._save.bind(this)),n.listen(aa,'submit',function(){return false;})];this._previousSaveData=p.serialize(this._root);var ha=m.scry(this._root,'div.backdateInput .periodMenu');for(var ia=0;ia<ha.length;ia++){var ja=ha[ia];this._listeners.push(n.listen(ja,'change',this._saveDate.bind(this)));}var ka=m.scry(aa,'.photoContextualSelector')[0];if(ka){var la=m.scry(ka,'.moveAlbum')[0];la&&this._listeners.push(n.listen(la,'click',this._move.bind(this)));var ma=m.scry(ka,'.albumCover')[0];ma&&this._listeners.push(n.listen(ma,'click',this._setAlbumCover.bind(this)));var na=m.scry(ka,'.removePhoto')[0];na&&this._listeners.push(n.listen(na,'click',this.remove.bind(this)));}else{var oa=m.find(aa,'.removePhotoButton');this._listeners.push(n.listen(oa,'click',this.remove.bind(this)));}this._placesDataListener=[ca.subscribe(['select','reset','render'],function(pa,qa){if(pa=='render'){k.addClass(this._root,'focusedInput');return;}if(pa=='reset'&&ca.getCore().getHiddenValue())return;if(qa&&qa.selected){w=qa.selected;if(x==w.text){y=true;}else{x=w.text;y=false;}}else{w=null;x=null;y=false;}this._hasOwnPlaceValue=pa=='select';k.conditionClass(m.find(aa,'.placeIcon'),'hasPlace',this._hasOwnPlaceValue);k.removeClass(this._root,'focusedInput');this._save();}.bind(this))];this._placesInputBlurListener=ca.getCore().subscribe('blur',function(pa,qa){k.removeClass(this._root,'focusedInput');}.bind(this));g.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.INITIALIZED'),this,g.BEHAVIOR_PERSISTENT);}z.prototype.getPhotoDataKey=function(){"use strict";return this._photoDataKey;};z.prototype.getPhotoData=function(){"use strict";return this._photoData;};z.prototype.getRoot=function(){"use strict";return this._root;};z.prototype.swapData=function(aa,ba){"use strict";var ca=this._mentionsTypeahead.getData(),da=this._placesTypeahead.getData();if(ca!==aa)this._mentionsTypeahead.swapData(aa);if(da!==ba){var ea=this._placesTypeahead.getCore().getValue(),fa=this._placesTypeahead.getCore().getHiddenValue();this._placesTypeahead.swapData(ba);if(this.hasOwnPlaceValue())this._placesTypeahead.getCore().select({text:ea,uid:fa});}};z.prototype.hasOwnPlaceValue=function(){"use strict";return this._hasOwnPlaceValue;};z.prototype.setAlbumPlace=function(aa){"use strict";this._hasOwnPlaceValue=false;var ba=this._placesTypeahead.getCore();k.conditionClass(m.find(this._root,'.placeIcon'),'hasPlace',!!aa);if(aa){ba.select(aa);this._save();}else ba.reset();};z.prototype.addPlaceSelectHandler=function(aa){"use strict";this._placesDataListener.push(this._placesTypeahead.subscribe('select',aa));};z.prototype.mapEventNameToNamespace=function(aa){"use strict";return aa+(this._editorId?'/'+this._editorId:'');};z.prototype.setDate=function(aa){"use strict";if(this._hasExistingDateValue)return;var ba=!aa,ca=aa;if(ba){if(!this._hasTimeTaken)return;ca=Math.round(this._photoData.timeTaken/600)*600*1000;}var da=m.find(this.getRoot(),'.uiProgressiveDatepicker'),ea=u.getInstance(da);ea.setDateWithTimestamp(ca);if(ba){k.conditionClass(m.find(this._root,'.dateIcon'),'hasDate',ba);this._saveDate();}};z.prototype._doRemove=function(){"use strict";this._listeners.forEach(function(aa){aa.remove();});this._listeners=[];this._placesDataListener.forEach(function(aa){this._placesTypeahead.unsubscribe(aa);}.bind(this));this._placesTypeahead.getCore().unsubscribe(this._placesInputBlurListener);m.remove(this._root);g.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.REMOVED'),this);};z.prototype._handleClick=function(aa){"use strict";var ba=aa.getTarget();if(r.byClass(ba,'confirmPhotoBackdate')){this._saveDate();return;}if(!r.byClass(ba,'metaIcon'))return;k.addClass(this._root,'showControls');if(r.byClass(ba,'placeIcon')){this._showMetadataInput('place');o.set(this._placesTypeahead.getCore().getElement());}else if(r.byClass(ba,'dateIcon')){this._showMetadataInput('date');}else if(r.byClass(ba,'peopleIcon')){this._showMetadataInput('people');}else k.removeClass(this._root,'showControls');};z.prototype.hideMetadataInputs=function(){"use strict";this._showMetadataInput();};z.prototype._showMetadataInput=function(aa){"use strict";['people','date','place'].forEach(function(ba){k.conditionClass(this._metadataInputs,ba,aa==ba);}.bind(this));};z.prototype._captionMouseEnter=function(aa){"use strict";this._showMetadataInput('place');};z.prototype._captionMouseLeave=function(aa){"use strict";if(!m.contains(this._placesTypeahead.getElement(),aa.getRelatedTarget())&&this._placesTypeahead.getCore().getElement()!=document.activeElement)this.hideMetadataInputs();};z.prototype._placesMouseLeave=function(aa){"use strict";if(!m.contains(this.caption,aa.getRelatedTarget())&&this._placesTypeahead.getCore().getElement()!=document.activeElement)this.hideMetadataInputs();};z.prototype._captionFocus=function(aa){"use strict";this.hideMetadataInputs();k.addClass(this._root,'focusedInput');};z.prototype.remove=function(){"use strict";var aa={fbid:this._photoData.fbid,version:s.BULK_EDITOR,confirmed:true};new l().setTitle("Delete Photo").setBody("Are you sure you want to delete this photo?").setButtons(l.OK_AND_CANCEL).setModal(true).setHandler(function(){k.addClass(this._root,'editablePhotoWillBeRemoved');new i().setURI('/ajax/photos/photo/delete/dialog.php').setData(aa).setHandler(function(ba){if(ba.getPayload().success){this._doRemove();}else k.removeClass(this._root,'editablePhotoWillBeRemoved');}.bind(this)).setErrorHandler(function(ba){k.removeClass(this._root,'editablePhotoWillBeRemoved');j.defaultErrorHandler(ba);}.bind(this)).send();}.bind(this)).show();};z.prototype._setAlbumCover=function(){"use strict";var aa={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,fbid:this._photoData.fbid,owner:this._photoData.owner,pid:this._photoData.pid},ba=new i().setURI('/ajax/photos/album/setcover/').setData(aa).setAllowCrossPageTransition(false);h.send(ba);};z.prototype._move=function(){"use strict";var aa={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,datakey:this._photoDataKey,fbid:this._photoData.fbid,owner:this._photoData.owner,pid:this._photoData.pid},ba=new i().setURI('/ajax/photos/photo/move/dialog.php').setData(aa).setAllowCrossPageTransition(false);h.send(ba);};z.prototype._timeclose=function(aa,ba){"use strict";aa=aa||0;ba=ba||0;return Math.abs(aa-ba)<43200;};z.prototype._placesFocus=function(aa){"use strict";k.addClass(this._root,'focusedInput');var ba=m.scry(this._root,'input.latitude')[0],ca=m.scry(this._root,'input.longitude')[0],da=m.scry(this._root,'input.takentime')[0],ea=da?q.getValue(da):null,fa=this._placesTypeahead.getData(),ga=fa.getBootstrapData(),ha={};if(ba&&ca){ha={latitude:q.getValue(ba),longitude:q.getValue(ca),proximity_boost:'true',city_id:null,search_time:ea};fa.setQueryData(ha,false);if(!t.placesClose(ga.latitude,ga.longitude,ha.latitude,ha.longitude)||!this._timeclose(ga.search_time,ha.search_time))fa.setBootstrapData(ha,false).setBootstrapEndpoint(fa.getQueryEndpoint());}else{ha={latitude:null,longitude:null,proximity_boost:null,city_id:null,search_time:ea};if(w)if(w.city_id){ha.city_id=w.city_id;}else if(w.latitude&&w.longitude){ha.latitude=w.latitude;ha.longitude=w.longitude;}fa.setQueryData(ha,false);if(!y){fa.setBootstrapData(ha).resetBootstrapEndpoint(true);}else if(!t.placesClose(ga.latitude,ga.longitude,ha.latitude,ha.longitude)||!this._timeclose(ga.search_time,ha.search_time))fa.setBootstrapData(ha,false).resetBootstrapEndpoint();}};z.prototype._saveDate=function(){"use strict";var aa=m.find(this._root,'div.backdateInput'),ba=p.serialize(aa);ba.source=this.source;ba.fbid=this._photoData.fbid;ba.version=s.BULK_EDITOR;k.addClass(aa,'backdating');new i().setURI('/ajax/photos/photo/backdate/').setData(ba).setRelativeTo(this._root).send();};z.prototype._save=function(){"use strict";var aa=p.serialize(this._root);if(this._previousSaveData){var ba=false;for(var ca in aa){if(ca!=='caption'&&ca!=='location'&&ca!=='location_data')continue;if(aa[ca]!==this._previousSaveData[ca]){ba=true;this._previousSaveData[ca]=aa[ca];}}if(!ba)return;}aa.source=this.source;aa.bulk=!this._hasOwnPlaceValue;k.removeClass(this._root,'focusedInput');new i().setURI('/ajax/photos/metadata/save/').setData(aa).setAllowCrossPageTransition(true).send();};e.exports=z;});
__d("PhotosBulkEditablePhotoPlaceholder",["CSS","DOM","Event","csx","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n,o){"use strict";this._root=m;this._progressBar=n;this._uploadID=o;this._initAndGetGatedButton("._3273",'cancelButtonClicked');this._retryButton=this._initAndGetGatedButton("._3p03",'retryButtonClicked');this._errorOkayButton=this._initAndGetGatedButton("._8qx",'dismissPlaceholder');this._errorCloseButton=this._initAndGetGatedButton("._8qy",'dismissPlaceholder');}l.prototype._initAndGetGatedButton=function(m,n){"use strict";var o=h.scry(this._root,m);if(o.length){o=o[0];i.listen(o,'click',function(){return this.emit(n,this._uploadID);}.bind(this));return o;}};l.prototype.getProgressBar=function(){"use strict";return this._progressBar;};l.prototype.getRoot=function(){"use strict";return this._root;};l.prototype.setStatus=function(m){"use strict";var n=h.find(this._root,'.editablePhotoPlaceholderStatus');h.setContent(n,m);};l.prototype.hide=function(){"use strict";g.hide(this._root);};l.prototype.show=function(){"use strict";g.show(this._root);};l.prototype.showRetryButton=function(){"use strict";this._retryButton&&g.show(this._retryButton);};l.prototype.showErrorOkayButton=function(){"use strict";this._errorOkayButton&&g.show(this._errorOkayButton);};l.prototype.showErrorCloseButton=function(){"use strict";this._errorCloseButton&&g.show(this._errorCloseButton);};k(l,{cancelButtonClicked:true,retryButtonClicked:true,dismissPlaceholder:true});e.exports=l;});
__d("PhotosBulkEditor",["Arbiter","AsyncRequest","CSS","DOM","Event","PageTransitions","Parent","PhotosConst","SelectorDeprecated","SortableGroup"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(r,s,t,u,v,w,x,y){"use strict";this.source=r;if(!s)return;this._root=s;this._id=s.getAttribute('id');this._photos={};this._tagger=null;this._isNamespaced=y;this._placeholder=v;this._waitingTemplate=w;this._mentionsData=t;this._placesData=u;this._albumPlace=null;this._userDate=null;this._useDateFromFile=false;this._albumCoverListeners={};this._albumCoverTracksFirstPhoto=(this.source===n.FLASH_UPLOADER);this._coverPhotoSortingID=null;if(x.canReorder)this._initSorting(x.autosaveReorder);var z=this._setPlace.bind(this),aa=[g.subscribe(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.INITIALIZED'),this._registerPhoto.bind(this)),g.subscribe(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.REMOVED'),function(ca,da){delete this._photos[da.getPhotoDataKey()];}.bind(this)),g.subscribe('PhotosBulkEditor.AUTO_ORDER',this._autoOrder.bind(this)),g.subscribe('PhotosBulkBackdateEditor.SAVED',function(ca,da){this._useDateFromFile=da.useDateFromFile;this._userDate=da.backdatedDate;this._setDate();}.bind(this)),g.subscribe('PhotoAlbumPlacesTypeahead.SELECTED_PLACE',z),g.subscribe('PhotoAlbumPlacesTypeahead.EXIST_PLACE',z),g.subscribe('PhotoAlbumPlacesTypeahead.RESET_PLACE',z),g.subscribe('PhotosBulkEditablePhoto.MOVED',function(ca,da){if(this.getPhotoData(da))this._photos[da]._doRemove();}.bind(this))],ba=o.subscribe('select',function(ca,da){var ea=i.hasClass(da.option,'removePhoto'),fa=i.hasClass(da.option,'albumCover');if(!ea&&!fa)return;var ga=(j.find(da.option,'.photo_id')).value;if(!this._photos[ga])return;var ha=this._photos[ga];if(ea){ha.remove();if(this._sortableGroup&&this._albumCoverTracksFirstPhoto)this._coverPhotoSortingID=this._sortableGroup.getOrder()[0];}else{this._makeAlbumCover(ha);this._albumCoverTracksFirstPhoto=false;}setTimeout(o.toggle.bind(o,da.selector),200);return false;}.bind(this));k.listen(this._root,'click',function(ca){var da=m.byClass(ca.getTarget(),'editablePhoto'),ea=this._photos;j.scry(this._root,'.showControls').forEach(function(fa){if(da!==fa){i.removeClass(fa,'showControls');ea[fa.id].hideMetadataInputs();}});}.bind(this));l.registerHandler(function(){aa.forEach(function(ca){ca.unsubscribe();});if(this._tagger)this._tagger.done();}.bind(this));this._autoOrderIncreasing=true;}q.prototype.init=function(r,s,t,u,v,w){"use strict";q.call(this,this.source,r,s,t,u,v,w);};q.prototype.getRoot=function(){"use strict";return this._root;};q.prototype.getSourceString=function(){"use strict";if(this.source===n.BULK_EDITOR){return 'bulk_editor';}else if(this.source===n.FLASH_UPLOADER){return 'flash_uploader';}else return null;};q.prototype.isNamespaced=function(){"use strict";return this._isNamespaced;};q.prototype.getVersionConst=function(){"use strict";return this.source;};q.prototype.getViewerSource=function(){"use strict";return null;};q.prototype.getViewerSet=function(){"use strict";return null;};q.prototype.registerTagger=function(r){"use strict";this._tagger=r;};q.prototype.needTaggingData=function(){"use strict";return this._tagger&&this._tagger.needTaggingData();};q.prototype.getPhotoData=function(r){"use strict";var s=this._photos[r];if(s)return s.getPhotoData();return {};};q.prototype.getPlaceholder=function(){"use strict";return this._placeholder;};q.prototype.getWaitingTemplate=function(){"use strict";return this._waitingTemplate;};q.prototype.addFaceboxes=function(r){"use strict";this._tagger&&this._tagger.addFaceboxes(r);};q.prototype.mapEventNameToNamespace=function(r){"use strict";return r+(this._isNamespaced?'/'+this._id:'');};q.prototype._registerPhoto=function(event,r){"use strict";this._photos[r.getPhotoDataKey()]=r;r.source=this.source;var s=r.getPhotoData(),t=s.fbid;if(this._sortableGroup)this._sortableGroup.addSortable(t,r.getRoot());r.swapData(this._mentionsData,this._placesData);if(this._sortableGroup)r.addPlaceSelectHandler(function(){this._sortableGroup.killDrag(t);}.bind(this));if(this._albumPlace&&!r.hasOwnPlaceValue())r.setAlbumPlace(this._albumPlace);if(this._sortableGroup&&this._albumCoverTracksFirstPhoto)this._coverPhotoSortingID=this._sortableGroup.getOrder()[0];};q.prototype._initSorting=function(r){"use strict";this._sortableGroup=new p().setDropCallback(function(s,t){var u=this._photos[t.id].getPhotoData(),v={order:this._sortableGroup.getOrder(),owner:u.owner};if(r){var w;if(u.set){v.set=u.set;w='/ajax/photos/sets/static/reorder.php';}else{v.album_fbid=u.albumFBID;w='/ajax/photos/reorder.php';}new h(w).setData(v).send();}if(this._sortableGroup&&this._albumCoverTracksFirstPhoto&&this._coverPhotoSortingID!==v.order[0]){var x=this._photos[this._sortableGroup.sortables[v.order[0]].id];if(x)this._makeAlbumCover(x);this._coverPhotoSortingID=v.order[0];}}.bind(this)).setBeforeGrabCallback(function(){g.inform(this.mapEventNameToNamespace('PhotosBulkEditor.PHOTO_REORDER_START'));}.bind(this));};q.prototype._compare=function(r,s,t){"use strict";if(t)return r.timeTaken<s.timeTaken;return r.timeTaken>s.timeTaken;};q.prototype._autoOrder=function(){"use strict";var r=this._sortableGroup.getOrder().map(function(x){return this._photos['editablePhoto_'+x].getPhotoData();}.bind(this));for(var s=0;s<r.length;s++){var t=s;for(var u=s+1;u<r.length;u++)if(this._compare(r[u],r[s],this._autoOrderIncreasing))t=u;if(s!==t){var v=r[t].fbid,w=r[s].fbid;this._sortableGroup.dragOverHandler(w,v);this._sortableGroup.dropHandler(v);r.splice(s,0,r.splice(t,1)[0]);}}this._autoOrderIncreasing=!this._autoOrderIncreasing;};q.prototype._setPlace=function(event,r){"use strict";this._albumPlace=r||null;var s;for(var t in this._photos){s=this._photos[t];s.hasOwnPlaceValue()||s.setAlbumPlace(this._albumPlace);}};q.prototype._setDate=function(){"use strict";var r='',s=null,t;for(var u in this._photos){t=this._photos[u];if(!this._useDateFromFile){r=this._userDate.month+'/'+this._userDate.day+'/'+this._userDate.year;s=new Date(r).getTime();}t.setDate(s);}};q.prototype._showAlbumCoverSet=function(r){"use strict";if(this._albumCover)i.removeClass(this._albumCover,"checked");var s=j.find(r.getRoot(),'.albumCover');i.addClass(s,"checked");this._albumCover=s;};q.prototype._makeAlbumCover=function(r){"use strict";new h().setURI('/ajax/photos/album/setcover').setData(r.getPhotoData()).setHandler(function(s){if(s.getPayload().success)this._showAlbumCoverSet(r);}.bind(this)).send();};q.prototype.getOrder=function(){"use strict";if(this._sortableGroup){return this._sortableGroup.getOrder();}else return [];};q.prototype.hasOrder=function(){"use strict";return !!this._sortableGroup;};e.exports=q;});
__d("PhotosBulkHeader",["Arbiter","AsyncRequest","DOM","Event","Form","Run","areJSONRepresentationsEqual","goURI","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(q,r,s,t){"use strict";this._form=q;this._isAlbum=r;this._editable=s;this._audience=t;this._backdatedTime=null;this._initialData=null;g.subscribe('PhotosBulkBackdateEditor.SAVED',function(u,v){if(!i.contains(this._form.getRoot(),v.context))return;this._backdatedTime=v.backdatedDate;}.bind(this));l.onBeforeUnload(function(){if(this.isDataDirty())return "Some of your changes have not been saved.  Would you like to save your changes now?";return false;}.bind(this));this._initialData=this.getSerializedData();}p.prototype.getSerializedData=function(){"use strict";var q=k.serialize(this._form.getRoot());if(this._backdatedTime)q.backTime=this._backdatedTime;return q;};p.prototype.isDataDirty=function(){"use strict";return !m(this._initialData,this.getSerializedData());};p.prototype.save=function(q){"use strict";if(!this._editable)return q.call();if(this._audience&&this._audience.removeHiddenPrivacyWidget)this._audience.removeHiddenPrivacyWidget();var r=this._isAlbum?'/ajax/photos/album/edit':'/ajax/photos/sets/edit',s=k.serialize(this._form.getRoot());if(this._backdatedTime)s.backdated_time=this._backdatedTime;new h(r).setData(s).setMethod('POST').setHandler(function(){this._initialData=this.getSerializedData();q();}.bind(this)).send();};p.doneButtonSaveHandler=function(q,r,s){"use strict";var t=q.save.bind(q,function(){n(r);return true;});q._listeners=[j.listen(s,'click',t)];};e.exports=p;});